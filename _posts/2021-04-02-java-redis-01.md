---
layout:     post
title:      "可不敢吹自己会Redis-01"
subtitle:   "Redis基础、常用数据结构和命令、为什么Redis很快、缓存穿透和缓存雪崩、Redis的瞬间卡顿"
date:       2021-04-02
author:     "ThreeJin"
header-mask: 0.5
catalog: true
header-img: "https://gitee.com/liaoxinyiqiqi/my-blog-images/raw/master/img/java-redis-bk.png"
tags:
    - Java
    - Redis

---
> 资料来源于网络上各位前辈（XXX）

### 前言
留下的坑，终究还是要来填的。之前一直计划着要把在项目里面使用Redis的一些踩坑记录一下，今天终于有时间来沉淀了。话不多说，直接开搞。
### redis 简介
简单来说 redis 就是一个数据库，不过与传统数据库不同的是 redis 的数据是存在内存中的，所以存写速度非常快，因此 redis 被广泛应用于缓存方向。另外，redis 也经常用来做分布式锁（这个目前在项目中还没有玩儿过）。redis 提供了多种数据类型来支持不同的业务场景。除此之外，redis 支持事务 、持久化、LUA脚本、LRU驱动事件、多种集群方案
### 为啥要用Redis？
- 高性能和分担压力  
那必须是高性能，操作缓存就是直接操作内存，所以速度相当快。如果数据库中的对应数据改变的之后，同步改变缓存中相应的数据即可。其次就是在高并发的时候可以分担数据库压力。  
- 为什么要用 redis 而不用 map/guava 做缓存?  
缓存分为本地缓存和分布式缓存。以 Java 为例，使用map 或者 guava 实现的是本地缓存，最主要的特点是轻量以及快速，生命周期随着 jvm 的销毁而结束。所以，在多实例的情况下，每个实例都是各自保存一份缓存，缓存不一致，或者说要做到缓存一致的话耗费的资源比较大。  
redis 或 memcached 可以做到分布式缓存，在多实例的情况下，各实例共用一份缓存数据，缓存具有一致性。缺点是需要保持 redis 或 memcached服务的高可用，整个程序架构上较为复杂。  
- redis 和 memcached 的区别  
    - redis支持更丰富的数据类型：String，list，hash，set，zset  
    - memcache支持简单的数据类型，String  
    - redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用,而Memecache把数据全部存在内存之中  
    - memcached没有原生的集群模式，需要依靠客户端来实现往集群中分片写入数据；但是 redis 目前是原生支持 cluster 模式的  
    - memcached是多线程，非阻塞IO复用的网络模型；Redis使用单线程的多路 IO 复用模型  
    
    ![](https://gitee.com/liaoxinyiqiqi/my-blog-images/raw/master/img/java-redis-01-01.jpg)  
    
### 常见数据结构
谈到Redis的数据结构，其实是指value的的类型，在这之前，先说一下redis的key  
##### key
redis的key 值是字符串储存的，这意味着可以用任何文本作为key值，从形如”foo”的简单字符串到一个JPEG文件的内容都可以  
**空字符串也是有效key值**  
键值不需要太长，首先消耗内存过多，其次键值计算成本较高（查询耗时长）  
key的几个命令：set、del、get、mget、exists、**incr**、**decr**、expire、type等
redis每创建一个key，都会为这个键储存一些附加的管理信息（比如这个键的类型，这个键最后一次被访问的时间等等），因此redis的key相对于值来说更珍贵  
reids数据库中的key越多，redis数据库服务器在储存附加管理信息方面耗费的内存就越多，在获取key对应的value值时cpu的开销也会更多  

##### String

- 常用命令: set,get,decr,incr,mget 等  
- value其实不仅可以是String，也可以是数字  

##### Hash

- 常用命令: hget,hset,hgetall 等  
- Hash 是一个 string 类型的 field 和 value 的映射表，有点像Map<String,Map<field,value>>，hash 特别适合用于存储对象，后续操作的时候，可以直接仅仅修改这个对象中的某个字段的值   
- 一个hash中最多包含2^32-1键值对  
- redis的key的过期功能只能对键操作，而**Hash结构不能单独对某一个filed设置过期功能**  

##### List

- 常用命令: lpush,rpush,lpop,rpop,lrange 等  
- list 就是链表，它的实现为一个双向链表，即可以支持反向查找和遍历，更方便操作，不过带来了部分额外的内存开销    
- 可以通过 lrange 命令，就是从某个元素开始读取多少个元素，可以基于 list 实现分页查询  
- 最多包含2^32-1元素  

##### Set

- 常用命令: sadd,spop,smembers,sunion 等  
- set 对外提供的功能与list类似是一个列表的功能，特殊之处在于 set 是可以自动排重的  

##### Sorted Set

- 常用命令: zadd,zrange,zrem,zcard 等  
- 和set相比，sorted set增加了一个权重参数score，使得集合中的元素能够按score进行有序排列  

#####  

### 其他坑
##### ip绑定问题
- Connection refused: connect  
把Redis的配置文件redis.conf里的 bind localhost（或者bind 127.0.0.1，表明只有该主机才能访问）注释掉，或者修改为：bind ip表明，只能通过ip访问  

    