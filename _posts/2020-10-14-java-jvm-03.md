---
layout:     post
title:      "细嚼慢咽JVM-03"
subtitle:   "类加载机制"
color:      "#e48c76"
date:       2020-10-14 23:59:00
author:     "ThreeJin"
catalog: true
header-img: "https://gitee.com/liaoxinyiqiqi/my-blog-images/raw/master/img/java-article.png"

tags:
    - Java
---
> 深入理解Java虚拟机——JVM高级特性与最佳实践(第2版)-读书笔记。

### 前言
&emsp;&emsp;写好的代码编译后就形成Class文件，然后由虚拟机把描述类的数据从Class文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的Java类型，这就是虚拟机的类加载机制
### 类生命周期
![](https://gitee.com/liaoxinyiqiqi/my-blog-images/raw/master/img/object-life.png)
<center>类的生命周期</center>
&emsp;&emsp;准确的说，类从被加载到虚拟机内存中一直到卸载出内存后，包括加载、验证、准备、解析、初始化、使用和卸载7个阶段。网上大多的资料说的5个阶段其实是把验证、准备和解析视为了连接阶段，其中解析有时候是可以在初始化之后开始的（比如动态绑定和晚期绑定），需要注意的是，这些阶段不是一个一个挨着按部就班进行，大多时候都是交叉混合式进行，也就是说在一个阶段执行过程中往往会调用并激活了另外一个阶段
##### 加载（Class Loading）
- **step1：**通过一个类的全限定名来获取定义此类的二进制字节流  
&emsp;&emsp;这里就是Java的魅力，从哪儿获取这些字节流，其实是开发者可以自己决定的（自定义类加载器来实现），很有意思。意味着，可以动态更改（动态代理、代码集群分发等等）。但是，只有非数组类才可以这样使用，因为数组类不通过类加载器创建，它是由虚拟机直接创建的。
- **step2：**将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构
- **step3：**在内存中生成一个代表这个类的Java.lang.Class对象，作为方法区这个类的各种数据的访问入口


### 总结
- 类生命周期：加载、验证、准备、解析、初始化、使用和卸载